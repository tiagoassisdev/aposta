<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/img/campo-de-futebol.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <title>Gerenciador de Apostas</title>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div header-logo>
          <h1>GERENCIADOR DE APOSTAS
          </h1>
        </div>

        <div class="stats">
          <div class="stat-card">
            <h3>TOTAL DE APOSTAS</h3>
            <div class="value" id="totalBets">0</div>
          </div>
          <div class="stat-card">
            <h3>APOSTAS GANHAS</h3>
            <div class="value" id="wonBets">0</div>
          </div>
          <div class="stat-card">
            <h3>APOSTAS PERDIDAS</h3>
            <div class="value" id="lostBets">0</div>
          </div>
          <div class="stat-card">
            <h3>LUCRO TOTAL</h3>
            <div class="value" id="totalProfit">R$ 0,00</div>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="switchTab('apostas')">
          <img src="/img/ticket-de-suporte (1).png" alt="" class="ticket"> MINHAS APOSTAS
        </button>
        <button class="tab" onclick="switchTab('agenda')">
          <img src="/img/time-and-calendar.png" alt="" class="time"> AGENDA DE JOGOS
        </button>
      </div>

      <!-- Tab: Apostas -->
      <div id="tab-apostas" class="tab-content active">
        <div class="form-section">
          <div header-logo>
          <h1>APOSTAS
          </h1>
        </div>
          <form id="betForm">
            <div class="form-grid">
              <div class="form-group">
                <label for="date">Data</label>
                <input type="date" id="date" required />
              </div>
              <div class="form-group">
                <label for="event">Evento</label>
                <input
                  type="text"
                  id="event"
                  placeholder="Ex: Flamengo vs Palmeiras"
                  required
                />
              </div>
              <div class="form-group">
                <label for="type">Tipo de Aposta</label>
                <input
                  type="text"
                  id="type"
                  placeholder="Ex: Resultado Final, Over/Under"
                  required
                />
              </div>
              <div class="form-group">
                <label for="odds">Odd</label>
                <input
                  type="text"
                  id="odds"
                  step="0.01"
                  placeholder="Ex: 2.50"
                  required
                />
              </div>
              <div class="form-group">
                <label for="stake">Valor Apostado (R$)</label>
                <input
                  type="text"
                  id="stake"
                  step="0.01"
                  placeholder="Ex: 50.00"
                  required
                />
              </div>
              <div class="form-group">
                <label for="status">Status</label>
                <select id="status" required>
                  <option value="pendente">Pendente</option>
                  <option value="ganhou">Ganhou</option>
                  <option value="perdeu">Perdeu</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="notes">Observações</label>
              <textarea
                id="notes"
                placeholder="Anotações sobre a aposta..."
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
              ADICIONAR APOSTA
            </button>
          </form>
        </div>

        <div class="filters">
          <div class="filter-group">
            <label for="filterStartDate">Data Inicial</label>
            <input type="date" id="filterStartDate" />
          </div>
          <div class="filter-group">
            <label for="filterEndDate">Data Final</label>
            <input type="date" id="filterEndDate" />
          </div>
          <div class="filter-group">
            <label for="filterStatus">Status</label>
            <select id="filterStatus">
              <option value="todos">Todos</option>
              <option value="ganhou">Ganhou</option>
              <option value="perdeu">Perdeu</option>
              <option value="pendente">Pendente</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="filterEvent">Buscar Evento</label>
            <input
              type="text"
              id="filterEvent"
              placeholder="Digite o nome do evento..."
            />
          </div>
          <button class="btn btn-primary" onclick="applyFilters()">
            FILTRAR
          </button>
          <button class="btn btn-primary" onclick="clearFilters()">
            LIMPAR
          </button>
        </div>

        <div class="table-section">
          <div header-logo>
          <h1>HISTÓRICO DE APOSTAS
          </h1>
        </div>
          <table id="betsTable">
            <thead>
              <tr>
                <th>DATA</th>
                <th>EVENTO</th>
                <th>TIPO</th>
                <th>ODD</th>
                <th>VALOR</th>
                <th>RETORNO</th>
                <th>LUCRO/PERDA</th>
                <th>STATUS</th>
                <th>AÇÕES</th>
              </tr>
            </thead>
            <tbody id="betsBody">
              <tr>
                <td colspan="9" class="empty-state">
                  <div>
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path
                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                      />
                    </svg>
                    <h3>Nenhuma aposta registrada ainda</h3>
                    <p>
                      Adicione sua primeira aposta usando o formulário acima
                    </p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Tab: Agenda -->
      <div id="tab-agenda" class="tab-content">
        <div class="form-section">
          <h2>📅 ADICIONAR JOGO NA AGENDA</h2>
          <form id="gameForm">
            <div class="form-grid">
              <div class="form-group">
                <label for="gameDate">Data do Jogo</label>
                <input type="date" id="gameDate" required />
              </div>
              <div class="form-group">
                <label for="gameTime">Horário</label>
                <input type="time" id="gameTime" required />
              </div>
              <div class="form-group">
                <label for="gameEvent">Confronto</label>
                <input
                  type="text"
                  id="gameEvent"
                  placeholder="Ex: Flamengo vs Palmeiras"
                  required
                />
              </div>
              <div class="form-group">
                <label for="gameLeague">Campeonato/Liga</label>
                <input
                  type="text"
                  id="gameLeague"
                  placeholder="Ex: Brasileirão Série A"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label for="gameNotes">Observações</label>
              <textarea
                id="gameNotes"
                placeholder="Anotações sobre o jogo..."
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
              ADICIONAR À AGENDA
            </button>
          </form>
        </div>

        <div class="table-section">
          <h2>⚽ PRÓXIMOS JOGOS</h2>
          <div class="upcoming-games" id="gamesContainer">
            <div class="empty-state" style="grid-column: 1/-1">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"
                />
              </svg>
              <h3>Nenhum jogo agendado</h3>
              <p>Adicione jogos futuros para não perder nenhuma oportunidade</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let bets = [];
      let games = [];
      let editingId = null;

      // Carregar dados
      function loadData() {
        bets = JSON.parse(localStorage.getItem("bets") || "[]");
        games = JSON.parse(localStorage.getItem("games") || "[]");
        renderBets(bets);
        renderGames();
        updateStats();
      }

      // Salvar dados
      function saveBets() {
        localStorage.setItem("bets", JSON.stringify(bets));
      }

      function saveGames() {
        localStorage.setItem("games", JSON.stringify(games));
      }

      // Trocar abas
      function switchTab(tab) {
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.remove("active"));
        document
          .querySelectorAll(".tab-content")
          .forEach((c) => c.classList.remove("active"));

        event.target.classList.add("active");
        document.getElementById("tab-" + tab).classList.add("active");
      }

      // Definir data de hoje como padrão
      document.getElementById("date").valueAsDate = new Date();
      document.getElementById("gameDate").valueAsDate = new Date();

      // Adicionar aposta
      document
        .getElementById("betForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const bet = {
            id: editingId || Date.now(),
            date: document.getElementById("date").value,
            event: document.getElementById("event").value,
            type: document.getElementById("type").value,
            odds: parseFloat(document.getElementById("odds").value),
            stake: parseFloat(document.getElementById("stake").value),
            status: document.getElementById("status").value,
            notes: document.getElementById("notes").value,
          };

          if (editingId) {
            const index = bets.findIndex((b) => b.id === editingId);
            bets[index] = bet;
            editingId = null;
          } else {
            bets.unshift(bet);
          }

          saveBets();
          renderBets(bets);
          updateStats();
          this.reset();
          document.getElementById("date").valueAsDate = new Date();
        });

      // Adicionar jogo à agenda
      document
        .getElementById("gameForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const game = {
            id: Date.now(),
            date: document.getElementById("gameDate").value,
            time: document.getElementById("gameTime").value,
            event: document.getElementById("gameEvent").value,
            league: document.getElementById("gameLeague").value,
            notes: document.getElementById("gameNotes").value,
          };

          games.push(game);
          games.sort((a, b) => {
            const dateA = new Date(a.date + " " + a.time);
            const dateB = new Date(b.date + " " + b.time);
            return dateA - dateB;
          });

          saveGames();
          renderGames();
          this.reset();
          document.getElementById("gameDate").valueAsDate = new Date();
        });

      // Renderizar jogos
      function renderGames() {
        const container = document.getElementById("gamesContainer");

        if (games.length === 0) {
          container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                        </svg>
                        <h3>Nenhum jogo agendado</h3>
                        <p>Adicione jogos futuros para não perder nenhuma oportunidade</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = games
          .map(
            (game) => `
                <div class="game-card">
                    <div class="game-date">📅 ${new Date(
                      game.date + "T00:00:00"
                    ).toLocaleDateString("pt-BR", {
                      weekday: "long",
                      day: "2-digit",
                      month: "long",
                    })}</div>
                    <div class="game-time">⏰ ${game.time}</div>
                    <div class="game-event">${game.event}</div>
                    <div class="game-league">🏆 ${game.league}</div>
                    ${
                      game.notes
                        ? `<div class="game-notes">${game.notes}</div>`
                        : ""
                    }
                    <div class="actions">
                        <button class="btn btn-small btn-success" onclick="convertToBet(${
                          game.id
                        })">Converter em Aposta</button>
                        <button class="btn btn-small btn-delete" onclick="deleteGame(${
                          game.id
                        })">Excluir</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Converter jogo em aposta
      function convertToBet(gameId) {
        const game = games.find((g) => g.id === gameId);
        if (!game) return;

        // Trocar para aba de apostas
        document.querySelectorAll(".tab")[0].click();

        // Preencher formulário
        document.getElementById("date").value = game.date;
        document.getElementById("event").value = game.event;
        document.getElementById("type").value = game.league;

        // Scroll suave até o formulário
        document
          .getElementById("betForm")
          .scrollIntoView({ behavior: "smooth", block: "start" });

        // Focar no campo de odd
        setTimeout(() => {
          document.getElementById("odds").focus();
        }, 500);
      }

      // Deletar jogo
      function deleteGame(id) {
        if (confirm("Deseja realmente excluir este jogo da agenda?")) {
          games = games.filter((g) => g.id !== id);
          saveGames();
          renderGames();
        }
      }

      // Renderizar apostas
      function renderBets(betsToRender) {
        const tbody = document.getElementById("betsBody");

        if (betsToRender.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <div>
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                                </svg>
                                <h3>Nenhuma aposta encontrada</h3>
                                <p>Tente ajustar os filtros ou adicione uma nova aposta</p>
                            </div>
                        </td>
                    </tr>
                `;
          return;
        }

        tbody.innerHTML = betsToRender
          .map((bet) => {
            const returnAmount =
              bet.status === "ganhou" ? bet.stake * bet.odds : 0;
            const profit =
              bet.status === "ganhou"
                ? returnAmount - bet.stake
                : bet.status === "perdeu"
                ? -bet.stake
                : 0;

            return `
                    <tr>
                        <td>${new Date(
                          bet.date + "T00:00:00"
                        ).toLocaleDateString("pt-BR")}</td>
                        <td><strong>${bet.event}</strong></td>
                        <td>${bet.type}</td>
                        <td>${bet.odds.toFixed(2)}</td>
                        <td>R$ ${bet.stake.toFixed(2)}</td>
                        <td>R$ ${returnAmount.toFixed(2)}</td>
                        <td style="color: ${
                          profit > 0
                            ? "#28a745"
                            : profit < 0
                            ? "#dc3545"
                            : "#aaa"
                        }; font-weight: bold;">
                            ${profit > 0 ? "+" : ""}R$ ${profit.toFixed(2)}
                        </td>
                        <td><span class="status ${bet.status}">${
              bet.status.charAt(0).toUpperCase() + bet.status.slice(1)
            }</span></td>
                        <td class="actions">
                            <button class="btn btn-small btn-delete" onclick="deleteBet(${
                              bet.id
                            })">Excluir</button>
                        </td>
                    </tr>
                `;
          })
          .join("");
      }

      // Atualizar estatísticas
      function updateStats() {
        const total = bets.length;
        const won = bets.filter((b) => b.status === "ganhou").length;
        const lost = bets.filter((b) => b.status === "perdeu").length;

        const profit = bets.reduce((sum, bet) => {
          if (bet.status === "ganhou") {
            return sum + (bet.stake * bet.odds - bet.stake);
          } else if (bet.status === "perdeu") {
            return sum - bet.stake;
          }
          return sum;
        }, 0);

        document.getElementById("totalBets").textContent = total;
        document.getElementById("wonBets").textContent = won;
        document.getElementById("lostBets").textContent = lost;
        document.getElementById(
          "totalProfit"
        ).textContent = `R$ ${profit.toFixed(2)}`;
        document.getElementById("totalProfit").style.color =
          profit >= 0 ? "#28a745" : "#dc3545";
      }

      // Deletar aposta
      function deleteBet(id) {
        if (confirm("Deseja realmente excluir esta aposta?")) {
          bets = bets.filter((b) => b.id !== id);
          saveBets();
          applyFilters();
          updateStats();
        }
      }

      // Aplicar filtros
      function applyFilters() {
        let filtered = [...bets];

        const startDate = document.getElementById("filterStartDate").value;
        const endDate = document.getElementById("filterEndDate").value;
        const status = document.getElementById("filterStatus").value;
        const eventSearch = document
          .getElementById("filterEvent")
          .value.toLowerCase();

        if (startDate) {
          filtered = filtered.filter((b) => b.date >= startDate);
        }

        if (endDate) {
          filtered = filtered.filter((b) => b.date <= endDate);
        }

        if (status !== "todos") {
          filtered = filtered.filter((b) => b.status === status);
        }

        if (eventSearch) {
          filtered = filtered.filter(
            (b) =>
              b.event.toLowerCase().includes(eventSearch) ||
              b.type.toLowerCase().includes(eventSearch)
          );
        }

        renderBets(filtered);
      }

      // Limpar filtros
      function clearFilters() {
        document.getElementById("filterStartDate").value = "";
        document.getElementById("filterEndDate").value = "";
        document.getElementById("filterStatus").value = "todos";
        document.getElementById("filterEvent").value = "";
        renderBets(bets);
      }

      // Carregar ao iniciar
      loadData();

      // Renderizar apostas (SUBSTITUIR a função renderBets existente)
      function renderBets(betsToRender) {
        const tbody = document.getElementById("betsBody");

        if (betsToRender.length === 0) {
          tbody.innerHTML = `
            <tr>
                <td colspan="9" class="empty-state">
                    <div>
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <h3>Nenhuma aposta encontrada</h3>
                        <p>Tente ajustar os filtros ou adicione uma nova aposta</p>
                    </div>
                </td>
            </tr>
        `;
          return;
        }

        tbody.innerHTML = betsToRender
          .map((bet) => {
            const returnAmount =
              bet.status === "ganhou" ? bet.stake * bet.odds : 0;
            const profit =
              bet.status === "ganhou"
                ? returnAmount - bet.stake
                : bet.status === "perdeu"
                ? -bet.stake
                : 0;

            return `
            <tr>
                <td>${new Date(bet.date + "T00:00:00").toLocaleDateString(
                  "pt-BR"
                )}</td>
                <td><strong>${bet.event}</strong></td>
                <td>${bet.type}</td>
                <td>${bet.odds.toFixed(2)}</td>
                <td>R$ ${bet.stake.toFixed(2)}</td>
                <td>R$ ${returnAmount.toFixed(2)}</td>
                <td style="color: ${
                  profit > 0 ? "#28a745" : profit < 0 ? "#dc3545" : "#aaa"
                }; font-weight: bold;">
                    ${profit > 0 ? "+" : ""}R$ ${profit.toFixed(2)}
                </td>
                <td><span class="status ${bet.status}">${
              bet.status.charAt(0).toUpperCase() + bet.status.slice(1)
            }</span></td>
                <td class="actions">
                    ${
                      bet.status === "pendente"
                        ? `<button class="btn btn-small btn-success" onclick="editBet(${bet.id})">Editar</button>`
                        : ""
                    }
                    <button class="btn btn-small btn-delete" onclick="deleteBet(${
                      bet.id
                    })">Excluir</button>
                </td>
            </tr>
        `;
          })
          .join("");
      }

      // ADICIONAR esta nova função após a função renderBets
      function editBet(id) {
        const bet = bets.find((b) => b.id === id);
        if (!bet) return;

        // Preencher o formulário com os dados da aposta
        document.getElementById("date").value = bet.date;
        document.getElementById("event").value = bet.event;
        document.getElementById("type").value = bet.type;
        document.getElementById("odds").value = bet.odds;
        document.getElementById("stake").value = bet.stake;
        document.getElementById("status").value = bet.status;
        document.getElementById("notes").value = bet.notes;

        // Armazenar o ID para edição
        editingId = bet.id;

        // Trocar para aba de apostas se estiver em outra
        document.querySelectorAll(".tab")[0].click();

        // Scroll até o formulário
        document
          .getElementById("betForm")
          .scrollIntoView({ behavior: "smooth", block: "start" });

        // Mudar texto do botão
        const submitBtn = document.querySelector(
          '#betForm button[type="submit"]'
        );
        submitBtn.textContent = "ATUALIZAR APOSTA";
        submitBtn.style.background = "#ffa500";
      }

      // Renderizar apostas (SUBSTITUIR a função renderBets existente)
function renderBets(betsToRender) {
    const tbody = document.getElementById('betsBody');
    
    if (betsToRender.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" class="empty-state">
                    <div>
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <h3>Nenhuma aposta encontrada</h3>
                        <p>Tente ajustar os filtros ou adicione uma nova aposta</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }

    tbody.innerHTML = betsToRender.map(bet => {
        const returnAmount = bet.status === 'ganhou' ? bet.stake * bet.odds : 0;
        const profit = bet.status === 'ganhou' ? returnAmount - bet.stake : 
                      bet.status === 'perdeu' ? -bet.stake : 0;
        
        return `
            <tr>
                <td>${new Date(bet.date + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                <td><strong>${bet.event}</strong></td>
                <td>${bet.type}</td>
                <td>${bet.odds.toFixed(2)}</td>
                <td>R$ ${bet.stake.toFixed(2)}</td>
                <td>R$ ${returnAmount.toFixed(2)}</td>
                <td style="color: ${profit > 0 ? '#28a745' : profit < 0 ? '#dc3545' : '#aaa'}; font-weight: bold;">
                    ${profit > 0 ? '+' : ''}R$ ${profit.toFixed(2)}
                </td>
                <td><span class="status ${bet.status}">${bet.status.charAt(0).toUpperCase() + bet.status.slice(1)}</span></td>
                <td class="actions">
                    <button class="btn btn-small btn-success" onclick="editBet(${bet.id})">Editar</button>
                    <button class="btn btn-small btn-delete" onclick="deleteBet(${bet.id})">Excluir</button>
                </td>
            </tr>
        `;
    }).join('');
}

// ADICIONAR esta nova função após a função renderBets
function editBet(id) {
    const bet = bets.find(b => b.id === id);
    if (!bet) return;

    // Preencher o formulário com os dados da aposta
    document.getElementById('date').value = bet.date;
    document.getElementById('event').value = bet.event;
    document.getElementById('type').value = bet.type;
    document.getElementById('odds').value = bet.odds;
    document.getElementById('stake').value = bet.stake;
    document.getElementById('status').value = bet.status;
    document.getElementById('notes').value = bet.notes;

    // Armazenar o ID para edição
    editingId = bet.id;

    // Trocar para aba de apostas se estiver em outra
    document.querySelectorAll('.tab')[0].click();

    // Scroll até o formulário
    document.getElementById('betForm').scrollIntoView({ behavior: 'smooth', block: 'start' });

    // Mudar texto do botão
    const submitBtn = document.querySelector('#betForm button[type="submit"]');
    submitBtn.textContent = 'ATUALIZAR APOSTA';
    submitBtn.style.background = '#ffa500';
}
    </script>
  </body>
</html>
